<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>theBattleoftheFatiz</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f8fafc;
        min-height: 100vh;
        color: #333;
      }

      .current-weight {
        color: #94baf9; /* bl√• f√§rg */
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      h1 {
        text-align: center;
        color: #4a5568;
        margin-bottom: 30px;
        font-size: 2.5em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      .players {
        display: flex;
        gap: 30px;
        margin-bottom: 40px;
        justify-content: center;
      }

      .player {
        text-align: center;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        padding: 25px;
        border-radius: 12px;
        color: white;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        flex: 1;
        max-width: 350px;
      }

      .player h2 {
        margin: 0 0 15px 0;
        font-size: 1.8em;
      }

      .start-weight {
        font-size: 1.4em;
        font-weight: bold;
      }

      .current-weight {
        font-size: 1.2em;
        margin-top: 10px;
      }

      .progress {
        margin-top: 15px;
        font-size: 1.1em;
        font-weight: bold;
      }

      .progress-bar-container {
        margin-top: 10px;
        width: 100%;
        height: 20px;
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.5);
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
        border-radius: 8px;
        transition: width 0.5s ease;
        position: relative;
      }

      .progress-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 12px;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        white-space: nowrap;
      }

      .winner {
        background: linear-gradient(135deg, #a7f3d0 0%, #6ee7b7 100%);
        box-shadow: 0 0 25px #fbbf24, 0 0 50px #fbbf24, 0 0 75px #fbbf24;
        animation: pulse 2s infinite,
          winner-glow 2s ease-in-out infinite alternate;
      }

      @keyframes winner-glow {
        from {
          box-shadow: 0 0 20px #fbbf24, 0 0 30px #fbbf24, 0 0 40px #fbbf24;
        }
        to {
          box-shadow: 0 0 30px #fbbf24, 0 0 40px #fbbf24, 0 0 50px #fbbf24;
        }
      }

      .leading {
        box-shadow: 0 0 25px #fbbf24, 0 0 50px #fbbf24, 0 0 75px #fbbf24;
        animation: glow 2s ease-in-out infinite alternate;
      }

      @keyframes glow {
        from {
          box-shadow: 0 0 20px #fbbf24, 0 0 30px #fbbf24, 0 0 40px #fbbf24;
        }
        to {
          box-shadow: 0 0 30px #fbbf24, 0 0 40px #fbbf24, 0 0 50px #fbbf24;
        }
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .weight-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .weight-table th {
        background: #fef3c7;
        color: #2d3748;
        padding: 15px;
        text-align: center;
        font-weight: bold;
        position: relative;
      }

      .leader-flag {
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        font-size: 20px;
        animation: wave 1s ease-in-out infinite;
      }

      @keyframes wave {
        0%,
        100% {
          transform: translateY(-50%) rotate(-10deg);
        }
        50% {
          transform: translateY(-50%) rotate(10deg);
        }
      }

      .weight-table td {
        padding: 12px;
        text-align: center;
        border-bottom: 1px solid #e2e8f0;
      }

      .weight-input {
        width: 80px;
        padding: 8px;
        border: 2px solid #e2e8f0;
        border-radius: 5px;
        text-align: center;
        font-size: 14px;
        transition: all 0.3s ease;
        -moz-appearance: textfield;
        appearance: textfield;
        -webkit-appearance: none;
      }

      .weight-input::-webkit-outer-spin-button,
      .weight-input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      .weight-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
      }

      .weight-up {
        background-color: #fed7d7;
        border-color: #e53e3e;
      }

      .weight-same {
        background-color: #fefcbf;
        border-color: #d69e2e;
      }

      .weight-down {
        background-color: #c6f6d5;
        border-color: #38a169;
      }

      .date-cell {
        font-weight: bold;
        background-color: #f7fafc;
        width: 100px;
      }

      @media (max-width: 768px) {
        .players {
          flex-direction: column;
          gap: 20px;
        }

        .container {
          padding: 20px;
        }

        .weight-table {
          font-size: 14px;
        }

        .weight-input {
          width: 60px;
          padding: 5px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üèÜ theBattleoftheFatiz üèÜ</h1>

      <div class="players">
        <div class="player" id="player1">
          <h2 id="player1Name">Jonisa the fatSlayer</h2>
          <div class="start-weight">Startvikt: 71,4 kg</div>
          <div
            class="current-weight"
            style="color: #97b9f1"
            id="player1Current"
          >
            Nuvarande: 71.3 kg
          </div>

          <div class="progress" id="player1Progress">√Öterst√•r: 5,0 kg</div>
          <div class="progress-bar-container">
            <div class="progress-bar" id="player1Bar" style="width: 0%">
              <div class="progress-text" id="player1BarText">0,0 / 5,0 kg</div>
            </div>
          </div>
        </div>
        <div class="player" id="player2">
          <h2 id="player2Name">Princess fatass</h2>
          <div class="start-weight">Startvikt: 65,5 kg</div>
          <div class="current-weight" id="player2Current">
            Nuvarande: 65,5 kg
          </div>
          <div class="progress" id="player2Progress">√Öterst√•r: 5,0 kg</div>
          <div class="progress-bar-container">
            <div class="progress-bar" id="player2Bar" style="width: 0%">
              <div class="progress-text" id="player2BarText">0,0 / 5,0 kg</div>
            </div>
          </div>
        </div>
      </div>

      <table class="weight-table">
        <thead>
          <tr>
            <th>Datum</th>
            <th>Jonisa the fatSlayer</th>
            <th>Princess fatass</th>
          </tr>
        </thead>
        <tbody id="weightTableBody">
          <tr>
            <td class="date-cell">08/22</td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                value="71.4"
                data-player="1"
                data-date="08/22"
              />
            </td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                value="65.5"
                data-player="2"
                data-date="08/22"
              />
            </td>
          </tr>
          <tr>
            <td class="date-cell">08/23</td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="1"
                data-date="08/23"
              />
            </td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="2"
                data-date="08/23"
              />
            </td>
          </tr>
          <tr>
            <td class="date-cell">08/24</td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="1"
                data-date="08/24"
              />
            </td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="2"
                data-date="08/24"
              />
            </td>
          </tr>
          <tr>
            <td class="date-cell">08/25</td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="1"
                data-date="08/25"
              />
            </td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="2"
                data-date="08/25"
              />
            </td>
          </tr>
          <tr>
            <td class="date-cell">08/26</td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="1"
                data-date="08/26"
              />
            </td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="2"
                data-date="08/26"
              />
            </td>
          </tr>
          <tr>
            <td class="date-cell">08/27</td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="1"
                data-date="08/27"
              />
            </td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="2"
                data-date="08/27"
              />
            </td>
          </tr>
          <tr>
            <td class="date-cell">08/28</td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="1"
                data-date="08/28"
              />
            </td>
            <td>
              <input
                type="number"
                class="weight-input"
                step="0.1"
                placeholder="0.0"
                data-player="2"
                data-date="08/28"
              />
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <script>
      const startWeights = { 1: 71.4, 2: 65.5 };
      const goalWeight = 5.0; // kg to lose
      let db = null;

      // üîπ Init Firebase
      async function initFirebase() {
        try {
          const { initializeApp } = await import(
            "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"
          );
          const { getFirestore, doc, setDoc, onSnapshot, collection } =
            await import(
              "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
            );

          const firebaseConfig = {
            apiKey: "AIzaSyAfDi2aM-MoE_HLj46oHHwqUYZ2ZZHObW4",
            authDomain: "thebattleofthefatiz-7b46f.firebaseapp.com",
            projectId: "thebattleofthefatiz-7b46f",
            storageBucket: "thebattleofthefatiz-7b46f.firebasestorage.app",
            messagingSenderId: "751651631192",
            appId: "1:751651631192:web:e3959014fe5334ebde5a2d",
            measurementId: "G-KCZQE9RGCL",
          };

          const app = initializeApp(firebaseConfig);
          db = getFirestore(app);
          console.log("Firebase initialized", db);

          // üîπ Lyssna p√• √§ndringar i "weights"
          const weightsRef = collection(db, "weights");
          onSnapshot(weightsRef, (snapshot) => {
            snapshot.docChanges().forEach((change) => {
              if (change.type === "added" || change.type === "modified") {
                const data = change.doc.data();
                const input = document.querySelector(
                  `input[data-player="${data.player}"][data-date="${data.date}"]`
                );
                if (input && input.value !== data.weight.toString()) {
                  input.value = data.weight;
                  updateWeightColors({ target: input });
                }
              }
            });
            updateProgress();
          });
        } catch (error) {
          console.log("Firebase not available, using localStorage only", error);
        }
      }

      // üîπ Spara vikt till Firebase
      async function saveToFirebase(player, date, weight) {
        if (!db) return;
        try {
          const { doc, setDoc } = await import(
            "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
          );

          const docId = `${date.replace(/\//g, "-")}-player${player}`;
          await setDoc(doc(db, "weights", docId), {
            player: parseInt(player),
            date: date,
            weight: parseFloat(weight),
            timestamp: new Date(),
          });
        } catch (error) {
          console.error("Firebase save error:", error);
        }
      }

      // üîπ LocalStorage
      function loadWeightData() {
        const savedData = localStorage.getItem("battleOfFatizWeights");
        if (savedData) {
          const weights = JSON.parse(savedData);
          Object.keys(weights).forEach((date) => {
            const player1Input = document.querySelector(
              `input[data-player="1"][data-date="${date}"]`
            );
            const player2Input = document.querySelector(
              `input[data-player="2"][data-date="${date}"]`
            );
            if (player1Input && weights[date].player1) {
              player1Input.value = weights[date].player1;
            }
            if (player2Input && weights[date].player2) {
              player2Input.value = weights[date].player2;
            }
          });
          document.querySelectorAll(".weight-input").forEach((input) => {
            if (input.value) updateWeightColors({ target: input });
          });
          updateProgress();
        }
      }

      function saveWeightData() {
        const data = {};
        document.querySelectorAll(".weight-input").forEach((input) => {
          const date = input.dataset.date;
          const player = input.dataset.player;
          if (!data[date]) data[date] = {};
          data[date]["player" + player] = parseFloat(input.value) || "";
        });
        localStorage.setItem("battleOfFatizWeights", JSON.stringify(data));
      }

      // üîπ Uppdatera f√§rg baserat p√• vikt√§ndring
      function updateWeightColors(event) {
        const input = event.target;
        const player = input.dataset.player;
        const date = input.dataset.date;
        const prevRow = input.closest("tr").previousElementSibling;
        let prevWeight = null;

        if (prevRow) {
          const prevInput = prevRow.querySelector(
            `input[data-player="${player}"]`
          );
          if (prevInput && prevInput.value)
            prevWeight = parseFloat(prevInput.value);
        }

        if (!prevWeight) prevWeight = startWeights[player];

        const weight = parseFloat(input.value);

        input.classList.remove("weight-up", "weight-down", "weight-same");

        if (!isNaN(weight)) {
          if (weight > prevWeight) input.classList.add("weight-up");
          else if (weight < prevWeight) input.classList.add("weight-down");
          else input.classList.add("weight-same");

          saveToFirebase(player, date, weight); // üîπ Spara i Firebase
        }

        saveWeightData();
        updateProgress();
      }

      // üîπ Uppdatera progress-bars och nuvarande vikt
      function updateProgress() {
        const playerWeights = {};

        [1, 2].forEach((player) => {
          const inputs = Array.from(
            document.querySelectorAll(`input[data-player="${player}"]`)
          ).filter((i) => i.value);

          let lastWeight = startWeights[player];
          if (inputs.length)
            lastWeight = parseFloat(inputs[inputs.length - 1].value);
          playerWeights[player] = lastWeight;

          const lost = Math.max(0, startWeights[player] - lastWeight);
          const remaining = Math.max(0, goalWeight - lost);
          const percent = Math.min((lost / goalWeight) * 100, 100);

          document.getElementById(`player${player}Current`).innerText =
            "Nuvarande: " + lastWeight.toFixed(1) + " kg";
          document.getElementById(`player${player}Progress`).innerText =
            "√Öterst√•r: " + remaining.toFixed(1) + " kg";
          document.getElementById(`player${player}Bar`).style.width =
            percent + "%";
          document.getElementById(`player${player}BarText`).innerText =
            lost.toFixed(1) + " / " + goalWeight + " kg";
        });

        // üîπ Best√§m vem som leder
        const lost1 = startWeights[1] - playerWeights[1];
        const lost2 = startWeights[2] - playerWeights[2];

        const player1Box = document.getElementById("player1");
        const player2Box = document.getElementById("player2");

        player1Box.classList.remove("leading");
        player2Box.classList.remove("leading");

        if (lost1 > lost2) player1Box.classList.add("leading");
        else if (lost2 > lost1) player2Box.classList.add("leading");
      }

      // üîπ Event listener
      document.querySelectorAll(".weight-input").forEach((input) => {
        input.addEventListener("input", updateWeightColors);
      });

      // üîπ Init
      loadWeightData();
      initFirebase();
    </script>
  </body>
</html>
